
<!DOCTYPE html>
<html>
<head>
  <title>Add New Seismogram</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
  <a href="/">‚Üê Back to Home</a>
  <h1>Add New Seismogram</h1>

<form id="imageForm">
  <label>Box ID:</label><br>
  <input type="text" id="box_id"><br><br>
  <label>Date Scanned:</label><br>
  <input type="date" id="date_scanned"><br><br>

  <label>Resolution:</label><br>
  <select id="resolution">
  <option value="300">300</option>
  <option value="600">600</option>
  <option value="1200">1200</option>
  <option value="361 (WWSSN)">361 (WWSSN)</option>
  <option value="other">Other</option>
  </select>
  <input type="number" id="custom_resolution" placeholder="Enter custom value" style="display:none;"><br><br>

  <label>Length:</label><br>
  <input type="number" step="0.01" id="length"><br><br>
  <label>Width:</label><br>
  <input type="number" step="0.01" id="width"><br><br>
  <label>Phase Markings:</label><br>
  <select id="phase_markings">
    <option value="True">True</option>
    <option value="False">False</option>
    <option value="NULL">Null</option>
  </select><br><br>

  <label>Bulletin:</label><br>
  <input type="text" id="bulletin"><br><br>

  <label>Occlusions:</label><br>
  <select id="occlusions">
    <option value="True">True</option>
    <option value="False">False</option>
    <option value="NULL">Null</option>
  </select><br><br>

  <label>Recording Type:</label><br>
<select id="recording_type">
  <option value="Photographic / Photosensitive">photographic / photosensitive</option>
  <option value="Thermal">thermal</option>
  <option value="Ink">ink</option>
  <option value="Smoke">smoke</option>
  <option value="Other">Other</option>
</select>
<input type="text" id="custom_recording_type" placeholder="Enter custom recording type" style="display:none;"><br><br>

  <label>Notes:</label><br>
  <textarea id="notes"></textarea><br><br>

  <label>Owner Contact:</label><br>
  <input type="text" id="owner_contact"><br><br>

  <label>Creator:</label><br>
  <input type="text" id="creator"><br><br>

  <label>Signal:</label><br>
  <select id="signal">
    <option value="True">True</option>
    <option value="False">False</option>
    <option value="NULL">Null</option>
  </select><br><br>

  <label>Timemark:</label><br>
  <input type="datetime-local" id="timemark"><br><br>

  <input type="submit" value="Submit">
</form>

<p id="imageResult"></p>

  <script>
   console.log("Script loaded");
  const SUPABASE_URL = 'https://ndysyydnaxtkwjikicoc.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5keXN5eWRuYXh0a3dqaWtpY29jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1ODAyNTQsImV4cCI6MjA2NzE1NjI1NH0.9LN1walCptD8bJkULcFjL2arqc4Ih-Rf3CRTJJ7_eyg';
 // created a Supabase client with your project URL and anon key
 const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  // Your image insert logic goes below
  const imageForm = document.getElementById('imageForm');
  const imageResult = document.getElementById('imageResult');

  imageForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    console.log("Submitting form...");
  // Handle resolution
  let resolutionValue = document.getElementById('resolution').value;
  if (resolutionValue === 'other') {
  resolutionValue = parseInt(document.getElementById('custom_resolution').value);
  } else if (resolutionValue === '361 (WWSSN)') {
  resolutionValue = 361;
  } else {
  resolutionValue = parseInt(resolutionValue);
  }
  if (isNaN(resolutionValue)) resolutionValue = null;

  // Handle recording type
  let recordingType = document.getElementById('recording_type').value;
  if (recordingType === 'other') {
  recordingType = document.getElementById('custom_recording_type').value;
  }

    
  const { data, error } = await client
  .from('image')
  .insert([{
    box_id: document.getElementById('box_id').value || null,
    date_scanned: document.getElementById('date_scanned').value || null,
    resolution: resolutionValue,
    length: parseFloat(document.getElementById('length').value),
    width: parseFloat(document.getElementById('width').value),
    phase_markings: document.getElementById('phase_markings').value.toLowerCase() === 'true' ? true :
                    document.getElementById('phase_markings').value.toLowerCase() === 'false' ? false : null,
    bulletin: document.getElementById('bulletin').value,
    occlusions: document.getElementById('occlusions').value.toLowerCase() === 'true' ? true :
                document.getElementById('occlusions').value.toLowerCase() === 'false' ? false : null,
    recording_type: recordingType,
    notes: document.getElementById('notes').value,
    owner_contact: document.getElementById('owner_contact').value,
    creator: document.getElementById('creator').value,
    signal: document.getElementById('signal').value.toLowerCase() === 'true' ? true :
            document.getElementById('signal').value.toLowerCase() === 'false' ? false : null,
    timemark: document.getElementById('timemark').value || null
  }]);


    if (error) {
       console.error("Insert error:", error);  // <-- shows detailed message in DevTools
      imageResult.textContent = 'Error: ' + error.message;
    } else {
      imageResult.textContent = 'Success! Image record added.';
      imageForm.reset();
    }
  });

    // Show/hide custom resolution field
  const resolutionDropdown = document.getElementById('resolution');
  const customResolutionInput = document.getElementById('custom_resolution');
  resolutionDropdown.addEventListener('change', () => {
    customResolutionInput.style.display = resolutionDropdown.value === 'other' ? 'block' : 'none';
  });

  // Show/hide custom recording type field
  const recordingDropdown = document.getElementById('recording_type');
  const customRecordingInput = document.getElementById('custom_recording_type');
  recordingDropdown.addEventListener('change', () => {
    customRecordingInput.style.display = recordingDropdown.value === 'other' ? 'block' : 'none';
  });
</script>

</body>
</html>
